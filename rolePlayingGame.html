<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>üêâ RPG - Dragon Repeller</title>
  <style>
    body {
      background-color: #0a0a23;
      font-family: "Trebuchet MS", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #fff;
    }
    #game {
      width: 500px;
      background: #1b1b38;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      overflow: hidden;
    }
    #stats, #controls, #monsterStats, #text {
      padding: 12px;
    }
    #stats {
      background: #111;
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }
    .bar-container {
      background: #333;
      border-radius: 6px;
      width: 100px;
      height: 14px;
      margin-left: 5px;
      overflow: hidden;
    }
    .bar {
      height: 100%;
      transition: width 0.3s ease;
    }
    .health-bar { background: #e63946; }
    .xp-bar { background: #06d6a0; }
    .gold-bar { background: #ffd166; }
    #controls {
      background: #222;
      display: flex;
      justify-content: space-around;
      gap: 5px;
    }
    button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      background: linear-gradient(#fecc4c, #ffac33);
      color: #0a0a23;
      transition: transform 0.2s, background 0.3s;
    }
    button:hover {
      transform: scale(1.05);
      background: linear-gradient(#ffd166, #f89808);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #monsterStats {
      display: none;
      background: #8b0000;
      border-radius: 8px;
      margin: 10px;
      padding: 10px;
    }
    #monsterStats strong {
      display: block;
      font-size: 1.1rem;
      margin-bottom: 5px;
    }
    #text {
      min-height: 80px;
      background: #0a0a23;
      font-size: 0.95rem;
      line-height: 1.4rem;
      border-top: 1px solid #333;
      animation: fadeIn 0.5s ease;
      white-space: pre-line;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="stats">
      <div>XP:
        <div class="bar-container"><div id="xpBar" class="bar xp-bar" style="width:0%"></div></div>
        <span id="xpText">0</span>
      </div>
      <div>Health:
        <div class="bar-container"><div id="healthBar" class="bar health-bar" style="width:100%"></div></div>
        <span id="healthText">100</span>
      </div>
      <div>Gold:
        <div class="bar-container"><div id="goldBar" class="bar gold-bar" style="width:50%"></div></div>
        <span id="goldText">50</span>
      </div>
    </div>

    <div id="controls">
      <button id="button1">Go to store</button>
      <button id="button2">Go to cave</button>
      <button id="button3">Fight dragon</button>
    </div>

    <div id="monsterStats">
      <strong><span id="monsterName"></span></strong>
      <div>Health:
        <div class="bar-container"><div id="monsterHealthBar" class="bar health-bar"></div></div>
        <span id="monsterHealth"></span>
      </div>
    </div>

    <div id="text">
      üè∞ Welcome to <b>Dragon Repeller</b>!<br>
      Defeat the dragon blocking the town gates. Choose your path using the buttons above.
    </div>
  </div>

  <script>
    // --- variables ---
    let xp = 0, health = 100, gold = 50, currentWeapon = 0;
    let fighting, monsterHealth, inventory = ["stick"];
    const weapons = [
      { name: 'stick', power: 5 },
      { name: 'dagger', power: 30 },
      { name: 'claw hammer', power: 50 },
      { name: 'sword', power: 100 }
    ];
    const monsters = [
      { name: "slime", level: 2, health: 15 },
      { name: "fanged beast", level: 8, health: 60 },
      { name: "dragon", level: 20, health: 300 }
    ];
    const locations = [
      {
        name: "town square",
        "button text": ["Go to store", "Go to cave", "Fight dragon"],
        "button functions": [goStore, goCave, fightDragon],
        text: "üèòÔ∏è You are in the town square. You see a sign that says 'Store'."
      },
      {
        name: "store",
        "button text": ["Buy 10 health (10 gold)", "Buy weapon (30 gold)", "Go to town square"],
        "button functions": [buyHealth, buyWeapon, goTown],
        text: "üõí You enter the store."
      },
      {
        name: "cave",
        "button text": ["Fight slime", "Fight fanged beast", "Go to town square"],
        "button functions": [fightSlime, fightBeast, goTown],
        text: "üï≥Ô∏è You enter the cave. You see some monsters lurking."
      },
      {
        name: "fight",
        "button text": ["Attack", "Dodge", "Run"],
        "button functions": [attack, dodge, goTown],
        text: "‚öîÔ∏è You are fighting a monster!"
      },
      {
        name: "kill monster",
        "button text": ["Go to town square", "Go to town square", "Go to town square"],
        "button functions": [goTown, goTown, easterEgg],
        text: "üíÄ The monster collapses. You gain XP and find gold!"
      },
      {
        name: "lose",
        "button text": ["REPLAY?", "REPLAY?", "REPLAY?"],
        "button functions": [restart, restart, restart],
        text: "‚ò†Ô∏è You died..."
      },
      { 
        name: "win", 
        "button text": ["REPLAY?", "REPLAY?", "REPLAY?"], 
        "button functions": [restart, restart, restart], 
        text: "üéâ You defeated the dragon! YOU WIN!" 
      },
      {
        name: "easter egg",
        "button text": ["2", "8", "Go to town square"],
        "button functions": [pickTwo, pickEight, goTown],
        text: "ü•ö Secret mini-game! Pick a number. If it matches the random draws, you win!"
      }
    ];

    // --- DOM ---
    const button1 = document.querySelector('#button1');
    const button2 = document.querySelector("#button2");
    const button3 = document.querySelector("#button3");
    const text = document.querySelector("#text");
    const xpText = document.querySelector("#xpText");
    const healthText = document.querySelector("#healthText");
    const goldText = document.querySelector("#goldText");
    const xpBar = document.querySelector("#xpBar");
    const healthBar = document.querySelector("#healthBar");
    const goldBar = document.querySelector("#goldBar");
    const monsterStats = document.querySelector("#monsterStats");
    const monsterName = document.querySelector("#monsterName");
    const monsterHealthText = document.querySelector("#monsterHealth");
    const monsterHealthBar = document.querySelector("#monsterHealthBar");

    // --- init buttons ---
    button1.onclick = goStore;
    button2.onclick = goCave;
    button3.onclick = fightDragon;

    function update(location) {
      monsterStats.style.display = "none";
      button1.innerText = location["button text"][0];
      button2.innerText = location["button text"][1];
      button3.innerText = location["button text"][2];
      button1.onclick = location["button functions"][0];
      button2.onclick = location["button functions"][1];
      button3.onclick = location["button functions"][2];
      text.innerHTML = location.text;
    }

    function updateBars() {
      xpText.innerText = xp;
      healthText.innerText = health;
      goldText.innerText = gold;
      xpBar.style.width = Math.min(xp, 100) + "%";
      healthBar.style.width = Math.max(health, 0) + "%";
      goldBar.style.width = Math.min(gold, 100) + "%";
    }

    function goTown() { update(locations[0]); }
    function goStore() { update(locations[1]); }
    function goCave() { update(locations[2]); }

    function buyHealth() {
      if (gold >= 10) { gold -= 10; health += 10; }
      else { text.innerText = "üí∞ Not enough gold."; }
      updateBars();
    }

    function buyWeapon() {
      if (currentWeapon < weapons.length - 1) {
        if (gold >= 30) {
          gold -= 30; currentWeapon++;
          let newWeapon = weapons[currentWeapon].name;
          text.innerText = "üó°Ô∏è You now have a " + newWeapon + ". Inventory: " + [...inventory, newWeapon];
          inventory.push(newWeapon);
        } else text.innerText = "üí∞ Not enough gold.";
      } else {
        text.innerText = "‚ö° You already own the strongest weapon!";
        button2.innerText = "Sell weapon for 15 gold";
        button2.onclick = sellWeapon;
      }
      updateBars();
    }

    function sellWeapon() {
      if (inventory.length > 1) {
        gold += 15;
        let sold = inventory.shift();
        text.innerText = "ü™ì You sold a " + sold + ". Inventory: " + inventory;
      } else text.innerText = "‚ùå Don‚Äôt sell your only weapon!";
      updateBars();
    }

    function fightSlime() { fighting = 0; goFight(); }
    function fightBeast() { fighting = 1; goFight(); }
    function fightDragon() { fighting = 2; goFight(); }

    function goFight() {
      update(locations[3]);
      monsterHealth = monsters[fighting].health;
      monsterStats.style.display = "block";
      monsterName.innerText = monsters[fighting].name;
      monsterHealthText.innerText = monsterHealth;
      monsterHealthBar.style.width = "100%";
    }

    function attack() {
      text.innerText = `üí• The ${monsters[fighting].name} attacks. You strike with your ${weapons[currentWeapon].name}.`;
      health -= getMonsterAttackValue(monsters[fighting].level);
      if (isMonsterHit()) {
        monsterHealth -= weapons[currentWeapon].power + Math.floor(Math.random() * xp) + 1;    
      } else text.innerText += " ‚ùå You missed!";
      if (health <= 0) lose();
      else if (monsterHealth <= 0) fighting === 2 ? winGame() : defeatMonster();
      if (Math.random() <= .1 && inventory.length !== 1) {
        text.innerText += " ‚ö†Ô∏è Your " + inventory.pop() + " broke!";
        currentWeapon--;
      }
      healthText.innerText = health;
      monsterHealthText.innerText = monsterHealth;
      monsterHealthBar.style.width = Math.max(monsterHealth, 0) / monsters[fighting].health * 100 + "%";
      updateBars();
    }

    function getMonsterAttackValue(level) {
      const hit = (level * 5) - (Math.floor(Math.random() * xp));
      return hit > 0 ? hit : 0;
    }
    function isMonsterHit() { return Math.random() > .2 || health < 20; }
    function dodge() { text.innerText = `üåÄ You dodged the ${monsters[fighting].name}'s attack.`; }
    function defeatMonster() {
      gold += Math.floor(monsters[fighting].level * 6.7);
      xp += monsters[fighting].level;
      update(locations[4]);
      updateBars();
    }
    function lose() { update(locations[5]); }
    function winGame() { update(locations[6]); }
    function restart() {
      xp = 0; health = 100; gold = 50; currentWeapon = 0; inventory = ["stick"];
      updateBars(); goTown();
    }
    function easterEgg() { update(locations[7]); }
    function pickTwo() { pick(2); }
    function pickEight() { pick(8); }
    function pick(guess) {
      const numbers = Array.from({length:10},()=>Math.floor(Math.random()*11));
      text.innerText = `üé≤ You picked ${guess}. Numbers: ${numbers.join(", ")}`;
      if (numbers.includes(guess)) { text.innerText += "\n‚úÖ You win 20 gold!"; gold += 20; }
      else { text.innerText += "\n‚ùå You lose 10 health."; health -= 10; if (health <= 0) lose(); }
      updateBars();
    }

    // start game
    updateBars();
  </script>
</body>
</html>